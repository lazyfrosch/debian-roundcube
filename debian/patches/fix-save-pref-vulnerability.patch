diff --git a/debian/patches/fix-save-pref-vulnerability.patch b/debian/patches/fix-save-pref-vulnerability.patch
index 2cb5621..a31d378 100644
diff --git a/program/include/rcube_plugin.php b/program/include/rcube_plugin.php
index 748d958..bf1e0bc 100644
--- a/program/include/rcube_plugin.php
+++ b/program/include/rcube_plugin.php
@@ -61,6 +61,14 @@ abstract class rcube_plugin
    */
   public $noframe = false;
 
+  /**
+   * A list of config option names that can be modified
+   * by the user via user interface (with save-prefs command)
+   *
+   * @var array
+   */
+  public $allowed_prefs;
+
   protected $home;
   protected $urlbase;
   private $mytask;
diff --git a/program/include/rcube_plugin_api.php b/program/include/rcube_plugin_api.php
index e762fff..fd339bc 100644
--- a/program/include/rcube_plugin_api.php
+++ b/program/include/rcube_plugin_api.php
@@ -34,6 +34,7 @@ class rcube_plugin_api
   public $config;
   
   public $handlers = array();
+  public $allowed_prefs = array();
   private $plugins = array();
   private $tasks = array();
   private $actions = array();
@@ -182,6 +183,11 @@ class rcube_plugin_api
             $plugin->init();
             $this->plugins[$plugin_name] = $plugin;
           }
+
+          if (!empty($plugin->allowed_prefs)) {
+              $this->allowed_prefs = array_merge($this->allowed_prefs, $plugin->allowed_prefs);
+          }
+
           return true;
         }
       }
diff --git a/program/steps/utils/save_pref.inc b/program/steps/utils/save_pref.inc
index 49e99e0..f9e8e20 100644
--- a/program/steps/utils/save_pref.inc
+++ b/program/steps/utils/save_pref.inc
@@ -21,6 +21,22 @@
 
 $name = get_input_value('_name', RCUBE_INPUT_POST);
 $value = get_input_value('_value', RCUBE_INPUT_POST);
+$whitelist = array(
+    'preview_pane',
+    'list_cols',
+    'collapsed_folders',
+    'collapsed_abooks',
+);
+
+if (!in_array($name, array_merge($whitelist, $RCMAIL->plugins->allowed_prefs))) {
+    raise_error(array('code' => 500, 'type' => 'php',
+        'file' => __FILE__, 'line' => __LINE__,
+        'message' => sprintf("Hack attempt detected (user: %s)", $RCMAIL->get_user_name())),
+        true, false);
+
+    $OUTPUT->reset();
+    $OUTPUT->send();
+}
 
 // save preference value
 $RCMAIL->user->save_prefs(array($name => $value));
