From 559cbabd0ee1b690f83a66c0ea732af6ec95b0bb Mon Sep 17 00:00:00 2001
From: Guilhem Moulin <guilhem@guilhem.org>
Date: Wed, 7 Dec 2016 10:59:50 +0100
Subject: [PATCH] Fix vulnerability in handling of mail()'s 5th argument

Apply upstream commit 45a3e81653eb6ad3685d1a9ab817a61df78178eb

    https://github.com/roundcube/roundcubemail/commit/45a3e81653eb6ad3685d1a9ab817a61df78178eb
---
 program/lib/Roundcube/rcube.php | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/program/lib/Roundcube/rcube.php b/program/lib/Roundcube/rcube.php
index 13356f2f..5f1b5f51 100644
--- a/program/lib/Roundcube/rcube.php
+++ b/program/lib/Roundcube/rcube.php
@@ -1749,7 +1749,7 @@ class rcube
                 if (filter_var(ini_get('safe_mode'), FILTER_VALIDATE_BOOLEAN))
                     $sent = mail($to, $subject, $msg_body, $header_str);
                 else
-                    $sent = mail($to, $subject, $msg_body, $header_str, "-f$from");
+                    $sent = mail($to, $subject, $msg_body, $header_str, '-f ' . escapeshellarg($from));
             }
         }
 
-- 
2.11.0

